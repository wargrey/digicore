\usepackage{ccaption}

\makeatletter
% \legend relies on \belowcaptionskip, which is not defined by the JFP class file:
\@ifundefined{belowcaptionskip}{\newlength{\belowcaptionskip}}{}

% `acmart` already provides `marginfigure`
\@ifundefined{marginfigure}{
  % \usepackage{snotez} brings `sidefigure` and `sidetable`, despite the conflicting with `sidenotes`
  \@ifundefined{sidefigure}
               {\usepackage{sidenotes}}
               {\newenvironment{marginfigure}{\begin{sidefigure}}{\end{sidefigure}}}}
\makeatother

% since worked with \centering for the legend,
% an extra vspace before the `hrule` is required
\newcommand{\JFPLegend}[1]{\vspace{8pt} \hrule width \hsize height .33pt \vspace{4pt} \legend{#1}}
\newcommand{\LegendContinued}[1]{\Legend{#1}}

\newcommand{\FigureTarget}[2]{#1}
\newcommand{\FigureRef}[2]{#1}

\newlength{\FigOrigskip}
\FigOrigskip=\parskip

% Put this before the figure content, so that a hyperref goes to the start of the content:
\newcommand{\FigureSetRef}{\refstepcounter{figure}}

\newenvironment{Figure}{\begin{figure}\FigureSetRef}{\end{figure}}
\newenvironment{FigureMultiWide}{\begin{figure*}[t!p]\FigureSetRef}{\end{figure*}}
\newenvironment{Herefigure}{\begin{figure}[ht!]\FigureSetRef\centering}{\end{figure}}

\newenvironment{Centerfigure}{\begin{Xfigure}\centering\item}{\end{Xfigure}}
\newenvironment{Leftfigure}{\begin{Xfigure}\item}{\end{Xfigure}}
\newenvironment{Rightfigure}{\begin{Xfigure}\item}{\end{Xfigure}}

\newenvironment{Xfigure}{\begin{list}{}{\leftmargin=0pt\topsep=0pt\parsep=\FigOrigskip\partopsep=0pt}}{\end{list}}
\newenvironment{FigureInside}{}{}

% `center` add too much vspace, whereas `centering` doesn't
\newcommand{\Centertext}[1]{\begin{center}#1\end{center}}
\newcommand{\Centeringtext}[1]{\centering#1}

% for margin figures
\newcommand{\MarginLegend}[1]{\hrule width \hsize height .33pt \legend{\footnotesize#1}}
\newenvironment{Marginfigure}{\begin{Mfigure}\item}{\end{Mfigure}}
\newenvironment{Mfigure}{\noindent\begin{list}{}{}}{\end{list}}
